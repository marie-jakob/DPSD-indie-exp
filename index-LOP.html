<!--
Main page of the experiment for the LOP manipulation.
    - imports relevant jspsych plugins + custom files
    - merges the parts of the experiment into the timeline that is given to
    JSPsych to run the experiment
    - sets relevant settings, such as preloading images, controlling browser
    interactions etc.

Author:    Marie Jakob <marie.a.jakob@gmail.com>
-->


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="jspsych-6.3.0/css/jspsych-custom.css">
    <!-- import JSPsych + plugins  -->
    <script src="jspsych-6.3.0/jspsych.js"></script>
    <script src="jspsych-6.3.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.3.0/plugins/jspsych-categorize-html.js"></script>
    <script src="jspsych-6.3.0/plugins/jspsych-html-slider-response.js"></script>
    <script src="jspsych-6.3.0/plugins/jspsych-instructions.js"></script>
    <script src="jspsych-6.3.0/plugins/jspsych-survey-text-custom.js"></script>
    <!-- import JATOS -->
    <script src="/assets/javascripts/jatos.js"></script>
    <!-- import custom files -->
    <script src="experiment-files/functions.js"></script>
    <script src="experiment-files/stimuli.js"></script>
    <script src="experiment-files/global-variables.js"></script>
    <script src="experiment-files/trials.js"></script>
    <script src="experiment-files/instructions.js"></script>
    <!--
    <script src="ExperimentFiles/survey_questions.js"></script>
    -->
</head>
<body></body>
<script>
    /* #####################################################################
                Setup
    ##################################################################### */

    // change to "true" to test the study in JATOS
    let JATOS = false;


    const ID = jsPsych.randomization.randomID(15);
    console.log("ID: ", ID);
    jsPsych.data.addProperties({
        subject: ID,
        condition: "LOP"
    });

    // contains timeline variables for the learning and the test phases
    // -> filter for the learning phase: "learned"
    // -> filter for the test phase: "test"
    let TIMELINE_VARS = gen_timeline_variables(STIMULI, LOP = true);

    let timeline = [];

    block_learning_LOP_1 = gen_learning_block(1, LOP = true);
    block_learning_LOP_2 = gen_learning_block(2, LOP = true);
    block_learning_LOP_3 = gen_learning_block(3, LOP = true);
    block_learning_LOP_4 = gen_learning_block(4, LOP = true);

    block_test_1 = gen_test_block(1);
    block_test_2 = gen_test_block(2);
    block_test_3 = gen_test_block(3);
    block_test_4 = gen_test_block(4);

    timeline = [
        welcome,
        instruction_learn,
        block_learning_LOP_1,
        instruction_test,
        block_test_1
    ];

    /* #####################################################################
                Go!
    ##################################################################### */

    if (JATOS) {
        jatos.onLoad(function () {
            jsPsych.init({
                timeline: timeline,
                use_webaudio: false,
                // control how often participants leave the browser tab / window
                on_interaction_data_update: function () {
                    control_browser_interactions();
                },
                on_finish: function () {
                    // if in JATOS mode, send data to JATOS at the end
                    var resultJson = jsPsych.data.get().json();
                    jatos.submitResultData(resultJson, jatos.startNextComponent);
                }
            });
        });
    } else {
        jsPsych.init({
            timeline: timeline,
            use_webaudio: false,
            // control how often participants leave the browser tab / window
            on_interaction_data_update: function () {
                control_browser_interactions();
            },
            // display and download data at the end
            on_finish: function () {
                var data = jsPsych.data.get().csv();
                let path = ID + "-test.csv";
                download(path, data);
                jsPsych.data.displayData();
            }
        });
    }

</script>
</html>